<!DOCTYPE html>  <html> <head>   <title>validated_package_meta_data.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="plugins.html">                 plugins.js               </a>                                           <a class="source" href="web_plugins.html">                 web_plugins.js               </a>                                           <a class="source" href="alternate_style_tag_selector.html">                 alternate_style_tag_selector.js               </a>                                           <a class="source" href="audioClipPlayer.html">                 audioClipPlayer.js               </a>                                           <a class="source" href="epub.html">                 epub.js               </a>                                           <a class="source" href="epub_controller.html">                 epub_controller.js               </a>                                           <a class="source" href="ibooks_options_parser.html">                 ibooks_options_parser.js               </a>                                           <a class="source" href="manifest_item.html">                 manifest_item.js               </a>                                           <a class="source" href="mediaOverlay.html">                 mediaOverlay.js               </a>                                           <a class="source" href="options_presenter.html">                 options_presenter.js               </a>                                           <a class="source" href="packageDocument.html">                 packageDocument.js               </a>                                           <a class="source" href="package_document_parser.html">                 package_document_parser.js               </a>                                           <a class="source" href="page_number_display_logic.html">                 page_number_display_logic.js               </a>                                           <a class="source" href="pagination_strategy_selector.html">                 pagination_strategy_selector.js               </a>                                           <a class="source" href="path_resolver.html">                 path_resolver.js               </a>                                           <a class="source" href="readium_options.html">                 readium_options.js               </a>                                           <a class="source" href="readium_pagination.html">                 readium_pagination.js               </a>                                           <a class="source" href="smilModel.html">                 smilModel.js               </a>                                           <a class="source" href="toc.html">                 toc.js               </a>                                           <a class="source" href="trigger.html">                 trigger.js               </a>                                           <a class="source" href="validated_package_meta_data.html">                 validated_package_meta_data.js               </a>                                           <a class="source" href="crx_library_namespace.html">                 crx_library_namespace.js               </a>                                           <a class="source" href="crx_viewer_namespace.html">                 crx_viewer_namespace.js               </a>                                           <a class="source" href="ws_lib_namespace.html">                 ws_lib_namespace.js               </a>                                           <a class="source" href="crx_library_router.html">                 crx_library_router.js               </a>                                           <a class="source" href="crx_viewer_router.html">                 crx_viewer_router.js               </a>                                           <a class="source" href="ws_router.html">                 ws_router.js               </a>                                           <a class="source" href="bb_file_system_sync.html">                 bb_file_system_sync.js               </a>                                           <a class="source" href="cookie_utils.html">                 cookie_utils.js               </a>                                           <a class="source" href="handlebars_helpers.html">                 handlebars_helpers.js               </a>                                           <a class="source" href="local_storage_sync.html">                 local_storage_sync.js               </a>                                           <a class="source" href="md5.html">                 md5.js               </a>                                           <a class="source" href="user_agent_utils.html">                 user_agent_utils.js               </a>                                           <a class="source" href="nav_widget_view.html">                 nav_widget_view.js               </a>                                           <a class="source" href="options_view.html">                 options_view.js               </a>                                           <a class="source" href="toc_view.html">                 toc_view.js               </a>                                           <a class="source" href="toolbar_view.html">                 toolbar_view.js               </a>                                           <a class="source" href="httpFileApi.html">                 httpFileApi.js               </a>                                           <a class="source" href="library.html">                 library.js               </a>                                           <a class="source" href="viewer.html">                 viewer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               validated_package_meta_data.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Used to validate a freshly unzipped package doc. Once we have 
validated it one time, we don't care if it is valid any more, we
just want to do our best to display it without failing</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">ValidatedPackageMetaData</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">file_path</span> <span class="o">=</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">file_path</span><span class="p">;</span>		
		<span class="k">this</span><span class="p">.</span><span class="nx">uri_obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URI</span><span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">root_url</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;package_doc_path&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">file_path</span><span class="p">);</span>
    <span class="p">},</span>

	<span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>

	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>for ease of use call parse before we set the attrs</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">reset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">attrs</span><span class="p">);</span>
	<span class="p">},</span>

	<span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
		<span class="nx">fixed_layout</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// default to fixed layout or reflowable format</span>
		<span class="nx">apple_fixed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// is this file Apple&#39;s spec</span>
		<span class="nx">open_to_spread</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// specific to Apple, should two up be allowed?</span>
		<span class="nx">cover_href</span><span class="o">:</span> <span class="s1">&#39;/images/library/missing-cover-image.png&#39;</span><span class="p">,</span> <span class="c1">// default to no cover image</span>
		<span class="nx">created_at</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="c1">// right now</span>
		<span class="nx">updated_at</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="c1">// right now</span>
		<span class="nx">paginate_backwards</span><span class="o">:</span> <span class="kc">false</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Apple created its own fixed layout spec for ibooks.
this function parses the metadata used by this spec</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">parseIbooksDisplayOptions</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">parser</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span>
		<span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">IbooksOptionsParser</span><span class="p">();</span>
		<span class="nx">result</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
	<span class="p">},</span>

	<span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>parse the xml</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">PackageDocumentParser</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">uri_obj</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xmlDom</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>only care about the metadata </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">return</span> <span class="nx">json</span><span class="p">.</span><span class="nx">metadata</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">save</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attrs</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>TODO: this should be done properly with a backbone sync</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
		<span class="nx">Lawnchair</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(),</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>TODO: confirm this needs to be here</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">resolveUri</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rel_uri</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">uri</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URI</span><span class="p">(</span><span class="nx">rel_uri</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">uri_obj</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>TODO: confirm this needs to be here
reslove a relative file path to relative to this the
the path of this pack docs file path</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">resolvePath</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">suffix</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">pack_doc_path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">file_path</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">suffix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">suffix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">ind</span> <span class="o">=</span> <span class="nx">pack_doc_path</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="nx">pack_doc_path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">ind</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">suffix</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 