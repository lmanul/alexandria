<!DOCTYPE html>  <html> <head>   <title>readium_pagination.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="plugins.html">                 plugins.js               </a>                                           <a class="source" href="web_plugins.html">                 web_plugins.js               </a>                                           <a class="source" href="alternate_style_tag_selector.html">                 alternate_style_tag_selector.js               </a>                                           <a class="source" href="audioClipPlayer.html">                 audioClipPlayer.js               </a>                                           <a class="source" href="epub.html">                 epub.js               </a>                                           <a class="source" href="epub_controller.html">                 epub_controller.js               </a>                                           <a class="source" href="ibooks_options_parser.html">                 ibooks_options_parser.js               </a>                                           <a class="source" href="manifest_item.html">                 manifest_item.js               </a>                                           <a class="source" href="mediaOverlay.html">                 mediaOverlay.js               </a>                                           <a class="source" href="options_presenter.html">                 options_presenter.js               </a>                                           <a class="source" href="packageDocument.html">                 packageDocument.js               </a>                                           <a class="source" href="package_document_parser.html">                 package_document_parser.js               </a>                                           <a class="source" href="page_number_display_logic.html">                 page_number_display_logic.js               </a>                                           <a class="source" href="pagination_strategy_selector.html">                 pagination_strategy_selector.js               </a>                                           <a class="source" href="path_resolver.html">                 path_resolver.js               </a>                                           <a class="source" href="readium_options.html">                 readium_options.js               </a>                                           <a class="source" href="readium_pagination.html">                 readium_pagination.js               </a>                                           <a class="source" href="smilModel.html">                 smilModel.js               </a>                                           <a class="source" href="toc.html">                 toc.js               </a>                                           <a class="source" href="trigger.html">                 trigger.js               </a>                                           <a class="source" href="validated_package_meta_data.html">                 validated_package_meta_data.js               </a>                                           <a class="source" href="crx_library_namespace.html">                 crx_library_namespace.js               </a>                                           <a class="source" href="crx_viewer_namespace.html">                 crx_viewer_namespace.js               </a>                                           <a class="source" href="ws_lib_namespace.html">                 ws_lib_namespace.js               </a>                                           <a class="source" href="crx_library_router.html">                 crx_library_router.js               </a>                                           <a class="source" href="crx_viewer_router.html">                 crx_viewer_router.js               </a>                                           <a class="source" href="ws_router.html">                 ws_router.js               </a>                                           <a class="source" href="bb_file_system_sync.html">                 bb_file_system_sync.js               </a>                                           <a class="source" href="cookie_utils.html">                 cookie_utils.js               </a>                                           <a class="source" href="handlebars_helpers.html">                 handlebars_helpers.js               </a>                                           <a class="source" href="local_storage_sync.html">                 local_storage_sync.js               </a>                                           <a class="source" href="md5.html">                 md5.js               </a>                                           <a class="source" href="user_agent_utils.html">                 user_agent_utils.js               </a>                                           <a class="source" href="nav_widget_view.html">                 nav_widget_view.js               </a>                                           <a class="source" href="options_view.html">                 options_view.js               </a>                                           <a class="source" href="toc_view.html">                 toc_view.js               </a>                                           <a class="source" href="toolbar_view.html">                 toolbar_view.js               </a>                                           <a class="source" href="httpFileApi.html">                 httpFileApi.js               </a>                                           <a class="source" href="library.html">                 library.js               </a>                                           <a class="source" href="viewer.html">                 viewer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               readium_pagination.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">ReadiumPagination</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span> 

	<span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
		<span class="s2">&quot;num_pages&quot;</span> <span class="o">:</span> <span class="mi">0</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PUBLIC" METHODS (THE API)                                                          //
------------------------------------------------------------------------------------ //</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: This is not ideal as it muddies the difference between the spine index position and 
  the page numbers that result from pagination. </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;spine_position&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Instantiate an object to decide what to display</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">pageNumberDisplayLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">PageNumberDisplayLogic</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>if content reflows and the number of pages in the section changes
we need to adjust the the current page</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:num_pages&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">adjustCurrentPage</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Description: This method determines which page numbers to display when switching
  between a single page and side-by-side page views and vice versa.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">toggleTwoUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;can_two_up&quot;</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: refactor page number display logic to this model</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">newPages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberDisplayLogic</span><span class="p">.</span><span class="nx">getPageNumbersForTwoUp</span> <span class="p">(</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">),</span> 
				<span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">),</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">),</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">()</span>
				<span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>this.epubController.set({two<em>up: !this.epubController.get("two</em>up")});</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">current_page</span><span class="o">:</span> <span class="nx">newPages</span><span class="p">});</span>
		<span class="p">}</span>	
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: This needs to be investigated, but I bet if the prevPage and nextPage methods were 
  called directly (goRight and goLeft were removed), the new page number display logic would account for the 
  page progression direction and that all this logic could be simplified.</p>

<p>Description: turn pages in the rightward direction
  ie progression direction is dependent on 
  page progression dir</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">goRight</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">prevPage</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>	
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Description: Turn pages in the leftward direction
  ie progression direction is dependent on 
  page progression dir</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">goLeft</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">prevPage</span><span class="p">();</span>	
		<span class="p">}</span>
	<span class="p">},</span>

	<span class="nx">goToPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">)</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">pagesToGoto</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberDisplayLogic</span><span class="p">.</span><span class="nx">getGotoPageNumsToDisplay</span><span class="p">(</span>
							<span class="nx">gotoPageNumber</span><span class="p">,</span>
							<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">),</span>
							<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">(),</span>
							<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">)</span>
							<span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="nx">pagesToGoto</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Description: Return true if the pageNum argument is a currently visible 
  page. Return false if it is not; which will occur if it cannot be found in 
  the array.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">isPageVisible</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageNum</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">pageNum</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PRIVATE" HELPERS                                                                   //
------------------------------------------------------------------------------------ //</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: This is public but not sure it should be; it's called from the navwidget and viewer.js</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">prevPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">curr_pg</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">lastPage</span> <span class="o">=</span> <span class="nx">curr_pg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Description: For fixed layout pubs, check if the last page is displayed; if so, end navigation.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">())</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">curr_pg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">curr_pg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">goToPrevSection</span><span class="p">();</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: The pagination/spine position relationship is still a bit muddied. As a result, 
  the assumption that a single content document (spine element) is rendered in every scrolling view must be
  enforced here with this scrolling view specific check condition. </p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">paginator</span><span class="p">.</span><span class="nx">shouldScroll</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
			     <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">())</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">goToPrevSection</span><span class="p">();</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Single page navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">)){</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">lastPage</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Reset spine position</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">)[</span><span class="nx">lastPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;spine_position&quot;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Move to previous page with two side-by-side pages</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="kd">var</span> <span class="nx">pagesToDisplay</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberDisplayLogic</span><span class="p">.</span><span class="nx">getPrevPageNumsToDisplay</span><span class="p">(</span>
								<span class="nx">lastPage</span><span class="p">,</span>
								<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">(),</span>
								<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">)</span>
								<span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="nx">pagesToDisplay</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Reset spine position</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">ind</span> <span class="o">=</span> <span class="p">(</span><span class="nx">lastPage</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">lastPage</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">)[</span><span class="nx">ind</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;spine_position&quot;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">},</span>

	<span class="nx">nextPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">curr_pg</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">firstPage</span> <span class="o">=</span> <span class="nx">curr_pg</span><span class="p">[</span><span class="nx">curr_pg</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>For fixed layout pubs, check if the last page is displayed; if so, end navigation</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">())</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
				<span class="p">(</span><span class="nx">curr_pg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">||</span> 
				 <span class="nx">curr_pg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span>
				<span class="p">)</span> <span class="p">{</span>

				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">curr_pg</span><span class="p">[</span><span class="nx">curr_pg</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;num_pages&quot;</span><span class="p">))</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">goToNextSection</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">))</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">firstPage</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Reset the spine position</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

				<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">)[</span><span class="nx">firstPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;spine_position&quot;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Two pages are being displayed</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="kd">var</span> <span class="nx">pagesToDisplay</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberDisplayLogic</span><span class="p">.</span><span class="nx">getNextPageNumsToDisplay</span><span class="p">(</span>
								<span class="nx">firstPage</span><span class="p">,</span>
								<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">().</span><span class="nx">isFixedLayout</span><span class="p">(),</span>
								<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">epub</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;page_prog_dir&quot;</span><span class="p">)</span>
								<span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="nx">pagesToDisplay</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Reset the spine position</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

				<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;rendered_spine_items&quot;</span><span class="p">)[</span><span class="nx">firstPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;spine_position&quot;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">},</span>

	<span class="nx">adjustCurrentPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">cp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;current_page&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">num</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;num_pages&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">two_up</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">epubController</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;two_up&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">cp</span><span class="p">[</span><span class="nx">cp</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">goToLastPage</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">},</span>	</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: this is strange in that it does not seem to account for 
  possibly crossing over a section boundary</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">goToLastPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;num_pages&quot;</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">goToPage</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 