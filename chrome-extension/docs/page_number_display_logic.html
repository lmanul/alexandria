<!DOCTYPE html>  <html> <head>   <title>page_number_display_logic.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="plugins.html">                 plugins.js               </a>                                           <a class="source" href="web_plugins.html">                 web_plugins.js               </a>                                           <a class="source" href="alternate_style_tag_selector.html">                 alternate_style_tag_selector.js               </a>                                           <a class="source" href="audioClipPlayer.html">                 audioClipPlayer.js               </a>                                           <a class="source" href="epub.html">                 epub.js               </a>                                           <a class="source" href="epub_controller.html">                 epub_controller.js               </a>                                           <a class="source" href="ibooks_options_parser.html">                 ibooks_options_parser.js               </a>                                           <a class="source" href="manifest_item.html">                 manifest_item.js               </a>                                           <a class="source" href="mediaOverlay.html">                 mediaOverlay.js               </a>                                           <a class="source" href="options_presenter.html">                 options_presenter.js               </a>                                           <a class="source" href="packageDocument.html">                 packageDocument.js               </a>                                           <a class="source" href="package_document_parser.html">                 package_document_parser.js               </a>                                           <a class="source" href="page_number_display_logic.html">                 page_number_display_logic.js               </a>                                           <a class="source" href="pagination_strategy_selector.html">                 pagination_strategy_selector.js               </a>                                           <a class="source" href="path_resolver.html">                 path_resolver.js               </a>                                           <a class="source" href="readium_options.html">                 readium_options.js               </a>                                           <a class="source" href="readium_pagination.html">                 readium_pagination.js               </a>                                           <a class="source" href="smilModel.html">                 smilModel.js               </a>                                           <a class="source" href="toc.html">                 toc.js               </a>                                           <a class="source" href="trigger.html">                 trigger.js               </a>                                           <a class="source" href="validated_package_meta_data.html">                 validated_package_meta_data.js               </a>                                           <a class="source" href="crx_library_namespace.html">                 crx_library_namespace.js               </a>                                           <a class="source" href="crx_viewer_namespace.html">                 crx_viewer_namespace.js               </a>                                           <a class="source" href="ws_lib_namespace.html">                 ws_lib_namespace.js               </a>                                           <a class="source" href="crx_library_router.html">                 crx_library_router.js               </a>                                           <a class="source" href="crx_viewer_router.html">                 crx_viewer_router.js               </a>                                           <a class="source" href="ws_router.html">                 ws_router.js               </a>                                           <a class="source" href="bb_file_system_sync.html">                 bb_file_system_sync.js               </a>                                           <a class="source" href="cookie_utils.html">                 cookie_utils.js               </a>                                           <a class="source" href="handlebars_helpers.html">                 handlebars_helpers.js               </a>                                           <a class="source" href="local_storage_sync.html">                 local_storage_sync.js               </a>                                           <a class="source" href="md5.html">                 md5.js               </a>                                           <a class="source" href="user_agent_utils.html">                 user_agent_utils.js               </a>                                           <a class="source" href="nav_widget_view.html">                 nav_widget_view.js               </a>                                           <a class="source" href="options_view.html">                 options_view.js               </a>                                           <a class="source" href="toc_view.html">                 toc_view.js               </a>                                           <a class="source" href="toolbar_view.html">                 toolbar_view.js               </a>                                           <a class="source" href="httpFileApi.html">                 httpFileApi.js               </a>                                           <a class="source" href="library.html">                 library.js               </a>                                           <a class="source" href="viewer.html">                 viewer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               page_number_display_logic.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Description: This model is responsible determining page numbers to display for both reflowable and fixed layout pubs.
Rationale: This model exists to abstract and encapsulate the logic for determining which pages numbers should be
  dispalyed in the viewer. The logic for this is reasonably complex, as there a number of different factors that must be
  taken into account in various cases. These include: The type of the pub (reflowable or fixed layout), the page progression direction, 
  the reading order of pages, the number of pages displayed on the screen and author preferences 
  for the location of pages (left/right/centre). </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">PageNumberDisplayLogic</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PUBLIC" METHODS (THE API)                                                          //
------------------------------------------------------------------------------------ //</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: This might be better named as getPageNumsToDisplay; the "goto" is confusing
Description: This method determines the page numbers to display, given a single page number to "go to"
Arguments (
  gotoPageNumber (integer): The page number to "go to"
  twoUp (boolean): Are two pages currently displayed in the reader?
  isFixedLayout (boolean): Are the current set of pages fixed layout pages? 
  pageProgDirection ("rtl" or "ltr): The page progression direction
)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getGotoPageNumsToDisplay</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">,</span> <span class="nx">twoUp</span><span class="p">,</span> <span class="nx">isFixedLayout</span><span class="p">,</span> <span class="nx">pageProgDirection</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">twoUp</span><span class="p">)</span> <span class="p">{</span>
			</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Fixed layout page</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">isFixedLayout</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="nx">pageProgDirection</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span>

					<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">))</span> <span class="p">{</span>

						<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">gotoPageNumber</span><span class="p">];</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">))</span> <span class="p">{</span>

						<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span><span class="p">,</span> <span class="nx">gotoPageNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>TODO: Handle center pages</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Left-to-right page progression</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">else</span> <span class="p">{</span>

					<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">))</span> <span class="p">{</span>

						<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span><span class="p">,</span> <span class="nx">gotoPageNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">gotoPageNumber</span><span class="p">))</span> <span class="p">{</span>

						<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">gotoPageNumber</span><span class="p">];</span>
					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>TODO: Handle center pages</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">}</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This is a reflowable page</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>in reflowable format, we want this config always:
ODD<em>PAGE |spine| EVEN</em>PAGE</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="nx">gotoPageNumber</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span><span class="p">,</span> <span class="nx">gotoPageNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>	
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">gotoPageNumber</span><span class="p">];</span>
				<span class="p">}</span>	
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			
			<span class="k">return</span> <span class="p">[</span><span class="nx">gotoPageNumber</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Description: Get the pages numbers to display when moving in reverse reading order
Arguments (
  prevPageNumberToDisplay (integer): The page to move to; this page must be one of the displayed pages
  isFixedLayout (boolean): Are the current set of pages fixed layout pages? 
  pageProgDirection ("rtl" or "ltr): The page progression direction <br />
)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getPrevPageNumsToDisplay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prevPageNumberToDisplay</span><span class="p">,</span> <span class="nx">isFixedLayout</span><span class="p">,</span> <span class="nx">pageProgDirection</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If fixed layout</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">isFixedLayout</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">pageProgDirection</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>If the first page is a left page in rtl progression, only one page 
can be displayed, even in two-up mode</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">prevPageNumberToDisplay</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
					<span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">prevPageNumberToDisplay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">prevPageNumberToDisplay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">prevPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">prevPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Left-to-right progresion</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">else</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">prevPageNumberToDisplay</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">prevPageNumberToDisplay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">prevPageNumberToDisplay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">prevPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">prevPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>A reflowable text</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="k">return</span> <span class="p">[</span><span class="nx">prevPageNumberToDisplay</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">prevPageNumberToDisplay</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Description: Get the pages to display when moving in reading order
Arguments (
  nextPageNumberToDisplay (integer): The page to move to; this page must be one of the displayed pages
  isFixedLayout (boolean): Are the current set of pages fixed layout pages? 
  pageProgDirection ("rtl" or "ltr): The page progression direction <br />
)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getNextPageNumsToDisplay</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nextPageNumberToDisplay</span><span class="p">,</span> <span class="nx">isFixedLayout</span><span class="p">,</span> <span class="nx">pageProgDirection</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If fixed layout</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">isFixedLayout</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">pageProgDirection</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>If the first page is a left page in rtl progression, only one page 
can be displayed, even in two-up mode</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">nextPageNumberToDisplay</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">nextPageNumberToDisplay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">nextPageNumberToDisplay</span><span class="p">,</span> <span class="nx">nextPageNumberToDisplay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">nextPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">nextPageNumberToDisplay</span><span class="p">)</span> <span class="o">&amp;&amp;</span> 
					<span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">nextPageNumberToDisplay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">nextPageNumberToDisplay</span><span class="p">,</span> <span class="nx">nextPageNumberToDisplay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>

					<span class="k">return</span> <span class="p">[</span><span class="nx">nextPageNumberToDisplay</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Reflowable section</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="k">return</span> <span class="p">[</span><span class="nx">nextPageNumberToDisplay</span><span class="p">,</span> <span class="nx">nextPageNumberToDisplay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Description: This method determines which page numbers to display when switching
between a single page and side-by-side page views and vice versa.
Arguments (
  twoUp (boolean): Are two pages currently displayed in the reader?
  displayedPageNumbers (array of integers): An array of page numbers that are currently displayed <br />
  isFixedLayout (boolean): Are the current set of pages fixed layout pages? 
  pageProgDirection ("rtl" or "ltr): The page progression direction
)
Notes: Authors can specify a fixed layout page as a "center" page, which prevents more than one page
  being displayed. This case is not handled yet.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getPageNumbersForTwoUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">twoUp</span><span class="p">,</span> <span class="nx">displayedPageNumbers</span><span class="p">,</span> <span class="nx">pageProgDirection</span><span class="p">,</span> <span class="nx">isFixedLayout</span><span class="p">)</span> <span class="p">{</span>

		<span class="kd">var</span> <span class="nx">displayed</span> <span class="o">=</span> <span class="nx">displayedPageNumbers</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">newPages</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Two pages are currently displayed; find the single page number to display</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">twoUp</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span> 
			<span class="k">else</span> <span class="p">{</span>
				
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>A single reflowable page is currently displayed; find two pages to display</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isFixedLayout</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
				<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>A single fixed layout page is displayed</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>page progression is right-to-left</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">pageProgDirection</span> <span class="o">===</span> <span class="s2">&quot;rtl&quot;</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
					
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
					
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>TODO: Handle center pages</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>page progression is left-to-right</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">else</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsLeft</span><span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
					
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">displayedPageIsRight</span><span class="p">(</span><span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
					
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
					<span class="nx">newPages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">displayed</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>TODO: Handle center pages</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nx">newPages</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PRIVATE" HELPERS                                                                   //
------------------------------------------------------------------------------------ //</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Description: The <code>displayedPageIs...</code> methods determine if a fixed layout page is right, left or center.</p>

<p>Note: This is not an ideal approach, as we're pulling properties directly out of the dom, rather than
out of our models. The rationale is that as of Readium 0.4.1, the page-spread-* value
is not maintained in the model hierarchy accessible from an ebook object. An alternative
would be to infer the left/right/center value from model attributes on ebook, or other objects in
ebook's object hierarchy. However, this would duplicate the logic that exists elsewhere for determining right/left/center
for a page, which is probably worse than pulling out of the dom. This approach also avoids having to convert
from the page number (based on what is rendered on the screen) to spine index. </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">displayedPageIsRight</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">displayedPageNum</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#page-&quot;</span> <span class="o">+</span> <span class="nx">displayedPageNum</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;right_page&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">displayedPageIsLeft</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">displayedPageNum</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#page-&quot;</span> <span class="o">+</span> <span class="nx">displayedPageNum</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;left_page&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">displayedPageIsCenter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">displayedPageNum</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#page-&quot;</span> <span class="o">+</span> <span class="nx">displayedPageNum</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;center_page&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">},</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 