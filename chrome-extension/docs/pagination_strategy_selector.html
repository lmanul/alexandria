<!DOCTYPE html>  <html> <head>   <title>pagination_strategy_selector.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="plugins.html">                 plugins.js               </a>                                           <a class="source" href="web_plugins.html">                 web_plugins.js               </a>                                           <a class="source" href="alternate_style_tag_selector.html">                 alternate_style_tag_selector.js               </a>                                           <a class="source" href="audioClipPlayer.html">                 audioClipPlayer.js               </a>                                           <a class="source" href="epub.html">                 epub.js               </a>                                           <a class="source" href="epub_controller.html">                 epub_controller.js               </a>                                           <a class="source" href="ibooks_options_parser.html">                 ibooks_options_parser.js               </a>                                           <a class="source" href="manifest_item.html">                 manifest_item.js               </a>                                           <a class="source" href="mediaOverlay.html">                 mediaOverlay.js               </a>                                           <a class="source" href="options_presenter.html">                 options_presenter.js               </a>                                           <a class="source" href="packageDocument.html">                 packageDocument.js               </a>                                           <a class="source" href="package_document_parser.html">                 package_document_parser.js               </a>                                           <a class="source" href="page_number_display_logic.html">                 page_number_display_logic.js               </a>                                           <a class="source" href="pagination_strategy_selector.html">                 pagination_strategy_selector.js               </a>                                           <a class="source" href="path_resolver.html">                 path_resolver.js               </a>                                           <a class="source" href="readium_options.html">                 readium_options.js               </a>                                           <a class="source" href="readium_pagination.html">                 readium_pagination.js               </a>                                           <a class="source" href="smilModel.html">                 smilModel.js               </a>                                           <a class="source" href="toc.html">                 toc.js               </a>                                           <a class="source" href="trigger.html">                 trigger.js               </a>                                           <a class="source" href="validated_package_meta_data.html">                 validated_package_meta_data.js               </a>                                           <a class="source" href="crx_library_namespace.html">                 crx_library_namespace.js               </a>                                           <a class="source" href="crx_viewer_namespace.html">                 crx_viewer_namespace.js               </a>                                           <a class="source" href="ws_lib_namespace.html">                 ws_lib_namespace.js               </a>                                           <a class="source" href="crx_library_router.html">                 crx_library_router.js               </a>                                           <a class="source" href="crx_viewer_router.html">                 crx_viewer_router.js               </a>                                           <a class="source" href="ws_router.html">                 ws_router.js               </a>                                           <a class="source" href="bb_file_system_sync.html">                 bb_file_system_sync.js               </a>                                           <a class="source" href="cookie_utils.html">                 cookie_utils.js               </a>                                           <a class="source" href="handlebars_helpers.html">                 handlebars_helpers.js               </a>                                           <a class="source" href="local_storage_sync.html">                 local_storage_sync.js               </a>                                           <a class="source" href="md5.html">                 md5.js               </a>                                           <a class="source" href="user_agent_utils.html">                 user_agent_utils.js               </a>                                           <a class="source" href="nav_widget_view.html">                 nav_widget_view.js               </a>                                           <a class="source" href="options_view.html">                 options_view.js               </a>                                           <a class="source" href="toc_view.html">                 toc_view.js               </a>                                           <a class="source" href="toolbar_view.html">                 toolbar_view.js               </a>                                           <a class="source" href="httpFileApi.html">                 httpFileApi.js               </a>                                           <a class="source" href="library.html">                 library.js               </a>                                           <a class="source" href="viewer.html">                 viewer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               pagination_strategy_selector.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Description: Chooses a pagination strategy</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>REFACTORING CANDIDATE: There is an issue here that is a bit hidden. Having this pagination strategy model attached to the 
  epub makes sense in that each spine item within an epub can be either reflowable or fixed. As such, when navigating through
  the epub, a decisions as to the type of pagination view must be made dynamically. However, at the moment, while it appears that
  this is how the pagination strategy is set up, in actual fact, an entire fixed layout epub is rendered based on the type of spine item
  found at the current spine_position. Since all the other spine items are then rendered assuming they are also fixed layout, the 
  pagination strategy is never called again when navigating to the other (possibly reflowable) spine items. This will have to be addressed
  at some point. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Readium</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">PaginationStrategySelector</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

	<span class="nx">renderToLastPage</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PUBLIC" METHODS (THE API)                                                          //
------------------------------------------------------------------------------------ //    </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;book&quot;</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Description: Determine what the current spine item is and render it
  Updates which spine items have been rendered in an array of rendered spine items</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">renderSpineItems</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">renderToLast</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">rendered_spine_positions</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>clean up the old view if there is one</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">destruct</span><span class="p">();</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Spine items as found in the package document can have attributes that override global settings for the ebook. This 
requires checking/creating the correct pagination strategy for each spine item</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">spineItem</span> <span class="o">=</span> <span class="nx">book</span><span class="p">.</span><span class="nx">getCurrentSection</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">spineItem</span><span class="p">.</span><span class="nx">isFixedLayout</span><span class="p">())</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">FixedPaginationView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">book</span><span class="p">});</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>A scrolling epub</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldScroll</span><span class="p">())</span> <span class="p">{</span>

				<span class="k">this</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">ScrollingPaginationView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">book</span><span class="p">});</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>A reflowable epub</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="p">{</span>

			<span class="k">this</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Readium</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">ReflowablePaginationView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">book</span><span class="p">});</span>
		<span class="p">}</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">rendered_spine_positions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">!!</span><span class="nx">renderToLast</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">rendered_spine_positions</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>------------------------------------------------------------------------------------ //
 "PRIVATE" HELPERS                                                                   //
------------------------------------------------------------------------------------ //  </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">shouldScroll</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">optionString</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">[</span><span class="s2">&quot;READIUM_OPTIONS&quot;</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">(</span><span class="nx">optionString</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">optionString</span><span class="p">)</span> <span class="p">)</span> <span class="o">||</span> <span class="p">{</span><span class="s2">&quot;singleton&quot;</span><span class="o">:</span> <span class="p">{}};</span>
		<span class="k">return</span> <span class="o">!</span><span class="nx">options</span><span class="p">[</span><span class="s2">&quot;singleton&quot;</span><span class="p">][</span><span class="s2">&quot;paginate_everything&quot;</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 