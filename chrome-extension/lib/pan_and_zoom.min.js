(function(i){var g=function(a){this.startRect=a;this.top=a.top;this.left=a.left;this.width=a.width;this.height=a.height;this.scale=1};g.prototype.applyConstraints=function(){};g.prototype.getZoom=function(){return this.height/this.startRect.height};g.prototype.getOffsetX=function(){return(this.left-this.startRect.left)/this.scale};g.prototype.getOffsetY=function(){return(this.top-this.startRect.top)/this.scale};g.prototype.pan=function(a,b){this.top+=b;this.left+=a};g.prototype.zoom=function(a,b,
c){a=(this.width+c)/this.startRect.width;b=a*this.startRect.height;this.width=a*this.startRect.width;this.height=b;this.scale=a;this.top-=0;this.left-=0};g.prototype.applyScale=function(a,b,c){c>4&&(c=4);c<0.1&&(c=0.1);a=c*this.startRect.height;this.width=c*this.startRect.width;this.height=a;this.scale=c;this.top-=0;this.left-=0};var k=function(a){var b="scale("+a.getZoom()+") ";b+="translate("+a.getOffsetX()+"px, "+a.getOffsetY()+"px)";return b},l=function(a,b,c,d,h){var e=null;a.mousewheel(function(a,
j){a.preventDefault();b.zoom(a.offsetX,a.offsetY,j*h.scaleRate);e&&clearTimeout(e);c();e=setTimeout(function(){d()},35)})},m=function(a,b,c,d){var h=!1,e=0,f=0;a.mousedown(function(a){h=!0;e=a.clientX;f=a.clientY;c()}).mouseup(function(){h=!1;d()}).mousemove(function(a){if(h)b.pan(a.clientX-e,a.clientY-f),b.applyConstraints(),e=a.clientX,f=a.clientY})},n=function(a,b,c,d){a.on("gesturestart",function(a){a.preventDefault();c()}).on("gestureend",function(a){a.preventDefault();d()}).on("gesturechange",
function(a){a.preventDefault();b.applyScale(0,0,a.originalEvent.scale);c()})};i.fn.zoomAndScale=function(a){a=i.extend({},i.fn.zoomAndScale.defaults,a);return this.each(function(){var b=i(this),c=i("body"),d=(b.width()-c.width())/2,h=(b.height()-c.height())/2+20;d>0&&b.css({position:"relative",right:d+"px",top:"-"+h+"px"});var e=!0,d={top:0,left:0,width:b.width(),height:b.height()},f=new g(d);f.applyScale(0,0,c.height()/b.height()*0.9);b.css("-webkit-transform",k(f));b.css("-webkit-transform",k(f));
var j=function(){e||(b.css("-webkit-transform",k(f)),setTimeout(j,a.frameRate))},c=function(){e&&(e=!1,j())},d=function(){e=!0};m(b,f,c,d,a);l(b,f,c,d,a);n(b,f,c,d,a)})};i.fn.zoomAndScale.defaults={frameRate:30,scaleRate:30}})(jQuery);
